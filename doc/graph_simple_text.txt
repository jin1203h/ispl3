================================================================================
ISPL LangGraph Agent êµ¬ì¡° - í…ìŠ¤íŠ¸ ë²„ì „
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸš€ ê·¸ë˜í”„ ì‹¤í–‰ íë¦„                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    [START]
       â”‚
       â”‚  ì‚¬ìš©ì ì§ˆì˜ ì…ë ¥
       â”‚  ì˜ˆ: "ì•” ì§„ë‹¨ë¹„ëŠ” ì–¼ë§ˆì¸ê°€ìš”?"
       â†“
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  ROUTER AGENT  â•‘  ğŸ§­ ì˜ë„ ë¶„ë¥˜
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       â”‚
       â”‚  - ì§ˆì˜ ë¶„ì„: í‚¤ì›Œë“œ ê¸°ë°˜ ì˜ë„ ì¶”ì¶œ
       â”‚  - ë¶„ë¥˜: search / upload / manage
       â”‚  - í˜„ì¬: ëª¨ë“  ì§ˆì˜ â†’ search_agentë¡œ ë¼ìš°íŒ…
       â”‚
       â†“ (Command goto)
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘ SEARCH AGENT   â•‘  ğŸ” ë²¡í„° ê²€ìƒ‰
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       â”‚
       â”‚  1. ì§ˆì˜ â†’ ì„ë² ë”© ë³€í™˜ (OpenAI text-embedding-3-large)
       â”‚  2. pgvector ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê²€ìƒ‰
       â”‚  3. ìƒìœ„ 5ê°œ ì²­í¬ ë°˜í™˜
       â”‚  4. ê²€ìƒ‰ ë¡œê·¸ ì €ì¥ (search_logs í…Œì´ë¸”)
       â”‚
       â†“
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘ ANSWER AGENT   â•‘  ğŸ’¬ ë‹µë³€ ìƒì„±
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       â”‚
       â”‚  1. ê²€ìƒ‰ ê²°ê³¼ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
       â”‚  2. GPT-4 í”„ë¡¬í”„íŠ¸ ìƒì„±
       â”‚     - í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€ ì§€ì¹¨
       â”‚     - ê²€ìƒ‰ ê²°ê³¼ ê¸°ë°˜ ë‹µë³€ ìš”êµ¬
       â”‚  3. ìµœì¢… ë‹µë³€ ìƒì„±
       â”‚
       â†“
    [END]
       â”‚
       â”‚  ìµœì¢… ìƒíƒœ ë°˜í™˜:
       â”‚  - final_answer: ìƒì„±ëœ ë‹µë³€
       â”‚  - search_results: ê²€ìƒ‰ëœ ì²­í¬ë“¤
       â”‚  - task_results: ê° Agent ì‹¤í–‰ ê²°ê³¼


================================================================================
State ê´€ë¦¬ (ISPLState)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ messages          : list    # LangGraph ë©”ì‹œì§€ ì´ë ¥                      â”‚
â”‚ next_agent        : str     # ë‹¤ìŒ ì‹¤í–‰í•  Agent                          â”‚
â”‚ task_type         : str     # ì‘ì—… ìœ í˜• (search/upload/manage)           â”‚
â”‚ task_results      : dict    # ê° Agentì˜ ì‹¤í–‰ ê²°ê³¼ (merge_dicts reducer) â”‚
â”‚ query             : str     # ì‚¬ìš©ì ì§ˆì˜                                â”‚
â”‚ search_results    : list    # ê²€ìƒ‰ ê²°ê³¼ ì²­í¬ë“¤                           â”‚
â”‚ final_answer      : str     # ìµœì¢… ë‹µë³€                                  â”‚
â”‚ error             : str     # ì˜¤ë¥˜ ì •ë³´ (ìˆì„ ê²½ìš°)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
Agent ìƒì„¸ ì„¤ëª…
================================================================================

ğŸ“ ROUTER AGENT (router_node)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ìœ„ì¹˜: backend/agents/router_agent.py
  
  ê¸°ëŠ¥:
    â€¢ ì‚¬ìš©ì ì§ˆì˜ì˜ ì˜ë„ë¥¼ ë¶„ë¥˜
    â€¢ ì ì ˆí•œ Agentë¡œ ë¼ìš°íŒ… ê²°ì •
    
  ë¶„ë¥˜ í‚¤ì›Œë“œ:
    - search: "ê²€ìƒ‰", "ì°¾ì•„", "ì•Œë ¤ì¤˜", "ë­ì•¼", "ê¶ê¸ˆ", "ì¡°íšŒ"
    - upload: "ì—…ë¡œë“œ", "ë“±ë¡", "ì¶”ê°€", "ìƒˆë¡œìš´ ì•½ê´€"
    - manage: "ê´€ë¦¬", "ëª©ë¡", "ì‚­ì œ", "ë‹¤ìš´ë¡œë“œ"
  
  í˜„ì¬ ìƒíƒœ:
    â†’ upload, manageëŠ” ë¯¸êµ¬í˜„
    â†’ ëª¨ë“  ì§ˆì˜ë¥¼ search_agentë¡œ ì „ë‹¬
  
  ì¶œë ¥:
    Command(goto="search_agent", update={...})


ğŸ“ SEARCH AGENT (search_node)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ìœ„ì¹˜: backend/agents/search_agent.py
  
  ê¸°ëŠ¥:
    â€¢ VectorSearchService í˜¸ì¶œ
    â€¢ ë²¡í„° ê²€ìƒ‰ ìˆ˜í–‰
    â€¢ ê²€ìƒ‰ ë¡œê·¸ ì €ì¥
  
  ê²€ìƒ‰ íŒŒë¼ë¯¸í„°:
    - threshold: 0.7 (ìœ ì‚¬ë„ ì„ê³„ê°’)
    - limit: 5 (ë°˜í™˜ ê²°ê³¼ ìˆ˜)
    - embedding_model: text-embedding-3-large (1536ì°¨ì›)
  
  ë°ì´í„°ë² ì´ìŠ¤:
    - í…Œì´ë¸”: document_chunks (pgvector HNSW ì¸ë±ìŠ¤)
    - ì—°ì‚°: ì½”ì‚¬ì¸ ìœ ì‚¬ë„ (<=> ì—°ì‚°ì)
  
  ì¶œë ¥:
    {
      "search_results": [...],
      "task_results": {"search": {...}},
      "next_agent": "answer_agent"
    }


ğŸ“ ANSWER AGENT (answer_node)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ìœ„ì¹˜: backend/agents/answer_agent.py
  
  ê¸°ëŠ¥:
    â€¢ ê²€ìƒ‰ ê²°ê³¼ ê¸°ë°˜ ë‹µë³€ ìƒì„±
    â€¢ GPT-4 í˜¸ì¶œ (gpt-4-turbo-preview)
    â€¢ í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€
  
  í”„ë¡¬í”„íŠ¸ êµ¬ì¡°:
    [ì‹œìŠ¤í…œ]
    - ë³´í—˜ì•½ê´€ ì „ë¬¸ê°€ í˜ë¥´ì†Œë‚˜
    - ê²€ìƒ‰ ê²°ê³¼ë§Œ ì‚¬ìš©
    - ë¶ˆí™•ì‹¤í•˜ë©´ "ëª¨ë¥´ê² ìŠµë‹ˆë‹¤" ë‹µë³€
    
    [ì‚¬ìš©ì]
    - ê²€ìƒ‰ëœ ì²­í¬ ë‚´ìš© ì œê³µ
    - ì¶œì²˜ ì •ë³´ (ë¬¸ì„œëª…, í˜ì´ì§€, ì„¹ì…˜)
    - ì‚¬ìš©ì ì§ˆì˜
  
  GPT-4 ì„¤ì •:
    - temperature: 0.1 (ì •í™•ì„± ìš°ì„ )
    - max_tokens: 1000
  
  ì¶œë ¥:
    {
      "final_answer": "...",
      "task_results": {"answer": {...}}
    }


================================================================================
ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™
================================================================================

ê²€ìƒ‰ ë¡œê·¸ (search_logs í…Œì´ë¸”):
  - ëª¨ë“  ê²€ìƒ‰ ê¸°ë¡ ì €ì¥
  - ìœ ì‚¬ë„ ì ìˆ˜, ì‘ë‹µ ì‹œê°„ ê¸°ë¡
  - ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘ ì¤€ë¹„

ë²¡í„° ì¸ë±ìŠ¤ (document_chunks):
  - pgvector HNSW ì¸ë±ìŠ¤
  - 1536ì°¨ì› ë²¡í„°
  - ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê²€ìƒ‰


================================================================================
í™•ì¥ ê³„íš
================================================================================

ğŸ”œ Upload Agent (ë¯¸êµ¬í˜„)
  - PDF íŒŒì¼ ì—…ë¡œë“œ
  - í…ìŠ¤íŠ¸ ì¶”ì¶œ ë° ì²­í‚¹
  - ì„ë² ë”© ìƒì„± ë° ì €ì¥

ğŸ”œ Manage Agent (ë¯¸êµ¬í˜„)
  - ë¬¸ì„œ ëª©ë¡ ì¡°íšŒ
  - ë¬¸ì„œ ì‚­ì œ
  - ë¬¸ì„œ ë©”íƒ€ë°ì´í„° ìˆ˜ì •

================================================================================

