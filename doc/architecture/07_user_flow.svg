<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 2100">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #1a1a1a; }
      .flow-title { font: bold 18px sans-serif; fill: #2c3e50; }
      .subtitle { font: bold 16px sans-serif; fill: #2c3e50; }
      .text { font: 14px sans-serif; fill: #34495e; }
      .small-text { font: 12px sans-serif; fill: #555; }
      .step-num { font: bold 20px sans-serif; fill: white; }
      
      /* 04_search_answer_flow_v2.svgì™€ ë™ì¼í•œ ìƒ‰ìƒ ìŠ¤íƒ€ì¼ */
      .box-start { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; }
      .box-action { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
      .box-system { fill: #f3e5f5; stroke: #7b1fa2; stroke-width: 2; }
      .box-result { fill: #e8f5e9; stroke: #388e3c; stroke-width: 2; }
      .box-end { fill: #e0f2f1; stroke: #00796b; stroke-width: 2; }
      .box-decision { fill: #fff9c4; stroke: #f57f17; stroke-width: 2; }
      
      .arrow { stroke: #424242; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-yes { stroke: #28a745; stroke-width: 2; fill: none; marker-end: url(#arrowhead-green); }
      .arrow-no { stroke: #f44336; stroke-width: 2; fill: none; marker-end: url(#arrowhead-red); }
      .arrow-label { font: 12px sans-serif; fill: #555; }
      
      .step-circle { fill: #1976d2; stroke: #0d47a1; stroke-width: 2; }
      .divider { stroke: #bbb; stroke-width: 1; stroke-dasharray: 5,3; }
      .label-new { font: bold 12px sans-serif; fill: #28a745; }
    </style>
    
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#424242" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#28a745" />
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#f44336" />
    </marker>
  </defs>

  <!-- Main Title -->
  <text x="700" y="40" text-anchor="middle" class="title">ISPL ì‚¬ìš©ì í”Œë¡œìš° (User Flow)</text>
  <text x="700" y="65" text-anchor="middle" class="small-text">ë³´í—˜ì•½ê´€ AI ì‹œìŠ¤í…œ - 3ê°€ì§€ ì£¼ìš” ì‹œë‚˜ë¦¬ì˜¤</text>

  <!-- ====== FLOW 1: ì±„íŒ… ì§ˆì˜ ====== -->
  <text x="80" y="110" class="flow-title">ğŸ’¬ Flow 1: AI ì±„íŒ… ì§ˆì˜ (Chat)</text>
  <line x1="60" y1="120" x2="680" y2="120" class="divider"/>

  <!-- Step 1 -->
  <circle cx="80" cy="160" r="24" class="step-circle"/>
  <text x="80" y="168" text-anchor="middle" class="step-num">1</text>
  
  <rect x="125" y="136" width="200" height="50" rx="10" class="box-start"/>
  <text x="225" y="159" text-anchor="middle" class="subtitle">ì±„íŒ… í˜ì´ì§€ ì ‘ì†</text>
  <text x="225" y="177" text-anchor="middle" class="small-text">/chat ê²½ë¡œ</text>

  <path d="M 325 161 L 375 161" class="arrow"/>

  <!-- Step 2 -->
  <circle cx="405" cy="160" r="24" class="step-circle"/>
  <text x="405" y="168" text-anchor="middle" class="step-num">2</text>
  
  <rect x="450" y="131" width="210" height="70" rx="10" class="box-action"/>
  <text x="555" y="157" text-anchor="middle" class="subtitle">ì§ˆë¬¸ ì…ë ¥</text>
  <text x="555" y="176" text-anchor="middle" class="small-text">"ê³¨ì ˆ ì‹œ ë³´í—˜ê¸ˆì„</text>
  <text x="555" y="191" text-anchor="middle" class="small-text">ì–¼ë§ˆë‚˜ ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?"</text>

  <path d="M 555 201 L 555 260" class="arrow"/>

  <!-- Step 3 -->
  <circle cx="525" cy="290" r="24" class="step-circle"/>
  <text x="525" y="298" text-anchor="middle" class="step-num">3</text>
  
  <rect x="340" y="266" width="300" height="90" rx="10" class="box-system"/>
  <text x="490" y="291" text-anchor="middle" class="subtitle">ì‹œìŠ¤í…œ ì²˜ë¦¬ (LangGraph)</text>
  <text x="490" y="311" text-anchor="middle" class="small-text">â€¢ Router Agent: ì˜ë„ ë¶„ì„</text>
  <text x="490" y="327" text-anchor="middle" class="small-text">â€¢ Search Agent: í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰</text>
  <text x="490" y="343" text-anchor="middle" class="small-text">â€¢ Answer Agent: GPT-4o ë‹µë³€</text>

  <path d="M 490 356 L 490 415" class="arrow"/>

  <!-- Step 4 -->
  <circle cx="460" cy="445" r="24" class="step-circle"/>
  <text x="460" y="453" text-anchor="middle" class="step-num">4</text>
  
  <rect x="290" y="421" width="300" height="90" rx="10" class="box-result"/>
  <text x="440" y="446" text-anchor="middle" class="subtitle">ë‹µë³€ í‘œì‹œ + ì°¸ì¡° ë¬¸ì„œ</text>
  <text x="440" y="466" text-anchor="middle" class="small-text">â€¢ ë‹µë³€ ë³¸ë¬¸ (Markdown)</text>
  <text x="440" y="482" text-anchor="middle" class="small-text">â€¢ ê´€ë ¨ ì•½ê´€ [ì°¸ì¡° 1][ì°¸ì¡° 2]</text>
  <text x="440" y="498" text-anchor="middle" class="small-text">â€¢ ë¬¸ì„œëª…, í˜ì´ì§€, ì¡°í•­ ë²ˆí˜¸</text>

  <path d="M 440 511 L 440 570" class="arrow"/>

  <!-- Step 5 -->
  <circle cx="410" cy="600" r="24" class="step-circle"/>
  <text x="410" y="608" text-anchor="middle" class="step-num">5</text>
  
  <rect x="285" y="576" width="210" height="50" rx="10" class="box-action"/>
  <text x="390" y="599" text-anchor="middle" class="subtitle">ì°¸ì¡° ë¬¸ì„œ í´ë¦­</text>
  <text x="390" y="617" text-anchor="middle" class="small-text">(ìš°ì¸¡ íŒ¨ë„ ì—´ë¦¼)</text>

  <path d="M 495 601 L 545 601" class="arrow"/>

  <!-- Step 6 -->
  <circle cx="575" cy="600" r="24" class="step-circle"/>
  <text x="575" y="608" text-anchor="middle" class="step-num">6</text>
  
  <rect x="620" y="571" width="210" height="70" rx="10" class="box-result"/>
  <text x="725" y="597" text-anchor="middle" class="subtitle">ì›ë¬¸ í™•ì¸</text>
  <text x="725" y="616" text-anchor="middle" class="small-text">â€¢ ì²­í¬ ì›ë¬¸</text>
  <text x="725" y="631" text-anchor="middle" class="small-text">â€¢ ìœ ì‚¬ë„ ì ìˆ˜</text>

  <path d="M 725 641 L 725 700" class="arrow"/>

  <!-- Step 7 -->
  <circle cx="695" cy="730" r="24" class="step-circle"/>
  <text x="695" y="738" text-anchor="middle" class="step-num">7</text>
  
  <rect x="590" y="706" width="200" height="50" rx="10" class="box-end"/>
  <text x="690" y="729" text-anchor="middle" class="subtitle">ëŒ€í™” ì´ë ¥ ìë™ ì €ì¥</text>
  <text x="690" y="747" text-anchor="middle" class="small-text">(chat_messages í…Œì´ë¸”)</text>


  <!-- ====== FLOW 2: ì•½ê´€ ì—…ë¡œë“œ ====== -->
  <text x="950" y="110" class="flow-title">ğŸ“„ Flow 2: ì•½ê´€ ì—…ë¡œë“œ (Document Management)</text>
  <line x1="870" y1="120" x2="1340" y2="120" class="divider"/>

  <!-- Step 1 -->
  <circle cx="900" cy="160" r="24" class="step-circle"/>
  <text x="900" y="168" text-anchor="middle" class="step-num">1</text>
  
  <rect x="945" y="136" width="200" height="50" rx="10" class="box-start"/>
  <text x="1045" y="159" text-anchor="middle" class="subtitle">ì•½ê´€ ê´€ë¦¬ í˜ì´ì§€</text>
  <text x="1045" y="177" text-anchor="middle" class="small-text">/documents ê²½ë¡œ</text>

  <path d="M 1145 161 L 1195 161" class="arrow"/>

  <!-- Step 2 -->
  <circle cx="1225" cy="160" r="24" class="step-circle"/>
  <text x="1225" y="168" text-anchor="middle" class="step-num">2</text>
  
  <rect x="1270" y="136" width="160" height="50" rx="10" class="box-action"/>
  <text x="1350" y="159" text-anchor="middle" class="subtitle">ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­</text>
  <text x="1350" y="177" text-anchor="middle" class="small-text">ëª¨ë‹¬ ì—´ë¦¼</text>

  <path d="M 1350 186 L 1350 245" class="arrow"/>

  <!-- Step 3 -->
  <circle cx="1320" cy="275" r="24" class="step-circle"/>
  <text x="1320" y="283" text-anchor="middle" class="step-num">3</text>
  
  <rect x="1180" y="246" width="250" height="110" rx="10" class="box-action"/>
  <text x="1305" y="271" text-anchor="middle" class="subtitle">íŒŒì¼ ë° ì •ë³´ ì…ë ¥</text>
  <text x="1305" y="291" text-anchor="middle" class="small-text">â€¢ PDF íŒŒì¼ ì„ íƒ</text>
  <text x="1305" y="307" text-anchor="middle" class="small-text">â€¢ ë¬¸ì„œ ìœ í˜• (ì•½ê´€/ì•ˆë‚´ì¥)</text>
  <text x="1305" y="323" text-anchor="middle" class="small-text">â€¢ ë³´í—˜ ì¢…ë¥˜ (ê±´ê°•/ì†í•´/ìƒëª…)</text>
  <text x="1305" y="339" text-anchor="middle" class="small-text">â€¢ ë³´í—˜ì‚¬ëª…</text>

  <path d="M 1305 356 L 1305 415" class="arrow"/>

  <!-- Step 4 -->
  <circle cx="1275" cy="445" r="24" class="step-circle"/>
  <text x="1275" y="453" text-anchor="middle" class="step-num">4</text>
  
  <rect x="1145" y="416" width="250" height="110" rx="10" class="box-system"/>
  <text x="1270" y="441" text-anchor="middle" class="subtitle">í•˜ì´ë¸Œë¦¬ë“œ ì „ì²˜ë¦¬ (ë°±ì—”ë“œ)</text>
  <text x="1270" y="461" text-anchor="middle" class="small-text">â€¢ Path 1: PyMuPDF4LLM</text>
  <text x="1270" y="477" text-anchor="middle" class="small-text">â€¢ Path 2: GPT-4o Vision</text>
  <text x="1270" y="493" text-anchor="middle" class="small-text">â€¢ Hybrid Merger</text>
  <text x="1270" y="509" text-anchor="middle" class="small-text">â€¢ Quality Validator</text>

  <path d="M 1270 526 L 1270 585" class="arrow"/>

  <!-- Step 5 -->
  <circle cx="1245" cy="615" r="24" class="step-circle"/>
  <text x="1245" y="623" text-anchor="middle" class="step-num">5</text>
  
  <rect x="1125" y="591" width="250" height="85" rx="10" class="box-system"/>
  <text x="1250" y="616" text-anchor="middle" class="subtitle">ì²­í‚¹ ë° ì„ë² ë”©</text>
  <text x="1250" y="636" text-anchor="middle" class="small-text">â€¢ TextChunker (1000 í† í°)</text>
  <text x="1250" y="652" text-anchor="middle" class="small-text">â€¢ EmbeddingService</text>
  <text x="1250" y="668" text-anchor="middle" class="small-text">â€¢ MemoryCache í™œìš©</text>

  <path d="M 1250 676 L 1250 735" class="arrow"/>

  <!-- Step 6 -->
  <circle cx="1225" cy="765" r="24" class="step-circle"/>
  <text x="1225" y="773" text-anchor="middle" class="step-num">6</text>
  
  <rect x="1105" y="736" width="250" height="100" rx="10" class="box-system"/>
  <text x="1230" y="761" text-anchor="middle" class="subtitle">DB ì €ì¥</text>
  <text x="1230" y="781" text-anchor="middle" class="small-text">â€¢ documents í…Œì´ë¸”</text>
  <text x="1230" y="797" text-anchor="middle" class="small-text">â€¢ document_chunks í…Œì´ë¸”</text>
  <text x="1230" y="813" text-anchor="middle" class="small-text">â€¢ pgvector ì„ë² ë”© ì €ì¥</text>
  <text x="1230" y="829" text-anchor="middle" class="small-text">â€¢ HNSW ì¸ë±ìŠ¤ ìƒì„±</text>

  <path d="M 1230 836 L 1230 895" class="arrow"/>

  <!-- Step 7 -->
  <circle cx="1205" cy="925" r="24" class="step-circle"/>
  <text x="1205" y="933" text-anchor="middle" class="step-num">7</text>
  
  <rect x="1110" y="901" width="180" height="50" rx="10" class="box-result"/>
  <text x="1200" y="924" text-anchor="middle" class="subtitle">ì—…ë¡œë“œ ì™„ë£Œ ì•Œë¦¼</text>
  <text x="1200" y="942" text-anchor="middle" class="small-text">ì²˜ë¦¬ ê²°ê³¼ í‘œì‹œ</text>

  <path d="M 1200 951 L 1200 1010" class="arrow"/>

  <!-- Step 8 -->
  <circle cx="1175" cy="1040" r="24" class="step-circle"/>
  <text x="1175" y="1048" text-anchor="middle" class="step-num">8</text>
  
  <rect x="1085" y="1016" width="170" height="50" rx="10" class="box-end"/>
  <text x="1170" y="1039" text-anchor="middle" class="subtitle">ë¬¸ì„œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</text>
  <text x="1170" y="1057" text-anchor="middle" class="small-text">ìƒˆ ì•½ê´€ í‘œì‹œ</text>


  <!-- ====== FLOW 3: ëŒ€í™” ì´ë ¥ ê´€ë¦¬ ====== -->
  <text x="80" y="1150" class="flow-title">ğŸ“‹ Flow 3: ëŒ€í™” ì´ë ¥ ê´€ë¦¬ (Chat History)</text>
  <line x1="60" y1="1160" x2="700" y2="1160" class="divider"/>

  <!-- Step 1 -->
  <circle cx="80" cy="1200" r="24" class="step-circle"/>
  <text x="80" y="1208" text-anchor="middle" class="step-num">1</text>
  
  <rect x="125" y="1176" width="200" height="50" rx="10" class="box-start"/>
  <text x="225" y="1199" text-anchor="middle" class="subtitle">ìµœê·¼ ëŒ€í™” í˜ì´ì§€</text>
  <text x="225" y="1217" text-anchor="middle" class="small-text">/history ê²½ë¡œ</text>

  <path d="M 325 1201 L 375 1201" class="arrow"/>

  <!-- Step 2 -->
  <circle cx="405" cy="1200" r="24" class="step-circle"/>
  <text x="405" y="1208" text-anchor="middle" class="step-num">2</text>
  
  <rect x="450" y="1171" width="200" height="70" rx="10" class="box-system"/>
  <text x="550" y="1197" text-anchor="middle" class="subtitle">ì„¸ì…˜ ëª©ë¡ ë¡œë“œ</text>
  <text x="550" y="1216" text-anchor="middle" class="small-text">chat_sessions ì¡°íšŒ</text>
  <text x="550" y="1231" text-anchor="middle" class="small-text">(ìµœì‹ ìˆœ ì •ë ¬)</text>

  <path d="M 550 1241 L 550 1300" class="arrow"/>

  <!-- Step 3 -->
  <circle cx="520" cy="1330" r="24" class="step-circle"/>
  <text x="520" y="1338" text-anchor="middle" class="step-num">3</text>
  
  <rect x="340" y="1306" width="270" height="85" rx="10" class="box-result"/>
  <text x="475" y="1331" text-anchor="middle" class="subtitle">ì„¸ì…˜ ëª©ë¡ í‘œì‹œ</text>
  <text x="475" y="1351" text-anchor="middle" class="small-text">â€¢ ì„¸ì…˜ ì œëª© (ì²« ì§ˆë¬¸)</text>
  <text x="475" y="1367" text-anchor="middle" class="small-text">â€¢ ìƒì„± ì‹œê°„</text>
  <text x="475" y="1383" text-anchor="middle" class="small-text">â€¢ ë©”ì‹œì§€ ê°œìˆ˜</text>

  <path d="M 475 1391 L 475 1450" class="arrow"/>

  <!-- Step 4 -->
  <circle cx="445" cy="1480" r="24" class="step-circle"/>
  <text x="445" y="1488" text-anchor="middle" class="step-num">4</text>
  
  <rect x="330" y="1456" width="200" height="50" rx="10" class="box-action"/>
  <text x="430" y="1479" text-anchor="middle" class="subtitle">ì„¸ì…˜ ì„ íƒ (í´ë¦­)</text>
  <text x="430" y="1497" text-anchor="middle" class="small-text">thread_id ì „ë‹¬</text>

  <path d="M 530 1481 L 590 1481" class="arrow"/>

  <!-- Step 5 -->
  <circle cx="620" cy="1480" r="24" class="step-circle"/>
  <text x="620" y="1488" text-anchor="middle" class="step-num">5</text>
  
  <rect x="665" y="1451" width="200" height="70" rx="10" class="box-system"/>
  <text x="765" y="1477" text-anchor="middle" class="subtitle">ë©”ì‹œì§€ ë¡œë“œ</text>
  <text x="765" y="1496" text-anchor="middle" class="small-text">chat_messages ì¡°íšŒ</text>
  <text x="765" y="1511" text-anchor="middle" class="small-text">(ì‹œê°„ìˆœ ì •ë ¬)</text>

  <path d="M 765 1521 L 765 1580" class="arrow"/>

  <!-- Step 6 -->
  <circle cx="735" cy="1610" r="24" class="step-circle"/>
  <text x="735" y="1618" text-anchor="middle" class="step-num">6</text>
  
  <rect x="600" y="1586" width="250" height="85" rx="10" class="box-result"/>
  <text x="725" y="1611" text-anchor="middle" class="subtitle">ëŒ€í™” ë‚´ì—­ í‘œì‹œ</text>
  <text x="725" y="1631" text-anchor="middle" class="small-text">â€¢ ì‚¬ìš©ì ì§ˆë¬¸ (íŒŒë€ìƒ‰)</text>
  <text x="725" y="1647" text-anchor="middle" class="small-text">â€¢ AI ë‹µë³€ (íšŒìƒ‰)</text>
  <text x="725" y="1663" text-anchor="middle" class="small-text">â€¢ ì‹œê°„ ìŠ¤íƒ¬í”„</text>

  <path d="M 725 1671 L 725 1730" class="arrow"/>

  <!-- Step 7 (Decision) -->
  <circle cx="695" cy="1760" r="24" class="step-circle"/>
  <text x="695" y="1768" text-anchor="middle" class="step-num">7</text>

  <!-- Decision Diamond -->
  <polygon points="725,1730 805,1785 725,1840 645,1785" class="box-decision"/>
  <text x="725" y="1790" text-anchor="middle" class="text">ê³„ì† ëŒ€í™”?</text>

  <path d="M 805 1785 L 885 1785" class="arrow-yes"/>
  <text x="835" y="1775" class="arrow-label" fill="#28a745">ì˜ˆ</text>
  
  <rect x="885" y="1757" width="180" height="56" rx="10" class="box-action"/>
  <text x="975" y="1781" text-anchor="middle" class="subtitle">ì±„íŒ… í˜ì´ì§€ ì´ë™</text>
  <text x="975" y="1799" text-anchor="middle" class="small-text">ì„¸ì…˜ ì´ì–´ê°€ê¸°</text>

  <path d="M 725 1840 L 725 1900" class="arrow-no"/>
  <text x="745" y="1870" class="arrow-label" fill="#f44336">ì•„ë‹ˆì˜¤</text>
  
  <rect x="650" y="1900" width="150" height="45" rx="10" class="box-end"/>
  <text x="725" y="1927" text-anchor="middle" class="subtitle">í˜ì´ì§€ ìœ ì§€</text>


  <!-- ====== ê³µí†µ ê¸°ëŠ¥ ì„¤ëª… ====== -->
  <rect x="80" y="2000" width="1240" height="80" rx="10" fill="#f5f5f5" stroke="#999" stroke-width="2"/>
  <text x="700" y="2030" text-anchor="middle" class="flow-title">âœ¨ ê³µí†µ ê¸°ëŠ¥ (Cross-Cutting Features)</text>
  
  <text x="150" y="2058" class="small-text">â€¢ ë¡œë”© ìƒíƒœ í‘œì‹œ (ìŠ¤í”¼ë„ˆ/í”„ë¡œê·¸ë ˆìŠ¤ë°”)</text>
  <text x="150" y="2074" class="small-text">â€¢ ì—ëŸ¬ í•¸ë“¤ë§ (Toast/Alert)</text>
  
  <text x="800" y="2058" class="small-text">â€¢ ìë™ ì €ì¥ (ëŒ€í™” ì´ë ¥ ë°±ê·¸ë¼ìš´ë“œ)</text>
  <text x="800" y="2074" class="small-text">â€¢ Markdown ë Œë”ë§ (react-markdown)</text>

</svg>
