<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1800">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #2c3e50; }
      .node-text { font: 16px sans-serif; fill: #2c3e50; }
      .edge-label { font: 12px sans-serif; fill: #666; }
      
      /* ë…¸ë“œ ìŠ¤íƒ€ì¼ */
      .node-start { fill: #e8eaf6; stroke: #5c6bc0; stroke-width: 2; }
      .node-agent { fill: #e1bee7; stroke: #8e24aa; stroke-width: 2; }
      .node-end { fill: #c5cae9; stroke: #5c6bc0; stroke-width: 2; }
      
      /* í™”ì‚´í‘œ ìŠ¤íƒ€ì¼ */
      .arrow-solid { stroke: #424242; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-dashed { stroke: #424242; stroke-width: 2; fill: none; marker-end: url(#arrowhead); stroke-dasharray: 5,5; }
      .arrow-conditional { stroke: #f57c00; stroke-width: 2; fill: none; marker-end: url(#arrowhead-orange); }
    </style>
    
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#424242" />
    </marker>
    <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#f57c00" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="1800" fill="#fafafa"/>

  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" class="title">ISPL LangGraph - Multi-Agent Workflow</text>

  <!-- START -->
  <ellipse cx="700" cy="100" rx="80" ry="40" class="node-start"/>
  <text x="700" y="108" text-anchor="middle" class="node-text">__start__</text>

  <!-- Arrow: start â†’ router_agent -->
  <path d="M 700 140 L 700 210" class="arrow-solid"/>

  <!-- Router Agent -->
  <rect x="600" y="210" width="200" height="80" rx="15" class="node-agent"/>
  <text x="700" y="245" text-anchor="middle" class="node-text">router_agent</text>
  <text x="700" y="265" text-anchor="middle" class="edge-label">ì˜ë„ ë¶„ì„</text>
  <text x="700" y="280" text-anchor="middle" class="edge-label">task_type ê²°ì •</text>

  <!-- Conditional routing from router_agent -->
  <path d="M 600 250 L 350 380" class="arrow-conditional"/>
  <text x="450" y="310" class="edge-label" fill="#f57c00">search</text>

  <path d="M 700 290 L 700 380" class="arrow-conditional"/>
  <text x="720" y="340" class="edge-label" fill="#f57c00">upload</text>

  <path d="M 800 250 L 1050 380" class="arrow-conditional"/>
  <text x="950" y="310" class="edge-label" fill="#f57c00">manage</text>

  <!-- Search Agent (ì™¼ìª½) -->
  <rect x="250" y="380" width="200" height="80" rx="15" class="node-agent"/>
  <text x="350" y="415" text-anchor="middle" class="node-text">search_agent</text>
  <text x="350" y="435" text-anchor="middle" class="edge-label">í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰</text>
  <text x="350" y="450" text-anchor="middle" class="edge-label">RRF ìœµí•©</text>

  <!-- Processing Agent (ì¤‘ì•™) -->
  <rect x="600" y="380" width="200" height="80" rx="15" class="node-agent"/>
  <text x="700" y="415" text-anchor="middle" class="node-text">processing_agent</text>
  <text x="700" y="435" text-anchor="middle" class="edge-label">PDF ì „ì²˜ë¦¬</text>
  <text x="700" y="450" text-anchor="middle" class="edge-label">í•˜ì´ë¸Œë¦¬ë“œ íŒŒì´í”„ë¼ì¸</text>

  <!-- Management Agent (ì˜¤ë¥¸ìª½) -->
  <rect x="950" y="380" width="200" height="80" rx="15" class="node-agent"/>
  <text x="1050" y="415" text-anchor="middle" class="node-text">management_agent</text>
  <text x="1050" y="435" text-anchor="middle" class="edge-label">ë¬¸ì„œ ê´€ë¦¬</text>
  <text x="1050" y="450" text-anchor="middle" class="edge-label">CRUD ì‘ì—…</text>

  <!-- Arrow: search_agent â†’ context_judgement_agent -->
  <path d="M 350 460 L 350 570" class="arrow-solid"/>

  <!-- Context Judgement Agent -->
  <rect x="250" y="570" width="200" height="80" rx="15" class="node-agent"/>
  <text x="350" y="605" text-anchor="middle" class="node-text">context_judgement</text>
  <text x="350" y="625" text-anchor="middle" class="edge-label">ì»¨í…ìŠ¤íŠ¸ ì¶©ë¶„ì„± íŒë‹¨</text>
  <text x="350" y="640" text-anchor="middle" class="edge-label">context_sufficient?</text>

  <!-- Conditional routing from context_judgement -->
  <path d="M 350 650 L 350 750" class="arrow-conditional"/>
  <text x="370" y="700" class="edge-label" fill="#28a745">ì¶©ë¶„</text>

  <path d="M 450 610 L 580 720" class="arrow-conditional"/>
  <text x="520" y="660" class="edge-label" fill="#f44336">ë¶ˆì¶©ë¶„</text>

  <!-- Chunk Expansion Agent (ì¬íŒë‹¨ ë£¨í”„) -->
  <rect x="580" y="680" width="200" height="80" rx="15" class="node-agent"/>
  <text x="680" y="715" text-anchor="middle" class="node-text">chunk_expansion</text>
  <text x="680" y="735" text-anchor="middle" class="edge-label">ì¸ì ‘ ì²­í¬ í™•ì¥</text>
  <text x="680" y="750" text-anchor="middle" class="edge-label">ìµœëŒ€ 3íšŒ ë°˜ë³µ</text>

  <!-- Arrow: chunk_expansion â†’ context_judgement (loop back) -->
  <path d="M 580 720 L 450 610" class="arrow-dashed"/>
  <text x="510" y="650" class="edge-label">ì¬íŒë‹¨</text>

  <!-- Answer Agent (í™•ì¥ë¨ - 4ë‹¨ê³„ ê²€ì¦ í¬í•¨) -->
  <rect x="220" y="750" width="260" height="140" rx="15" class="node-agent"/>
  <text x="350" y="780" text-anchor="middle" class="node-text">answer_agent</text>
  <text x="350" y="800" text-anchor="middle" class="edge-label">GPT-4o ë‹µë³€ ìƒì„±</text>
  <text x="350" y="820" text-anchor="middle" class="edge-label" font-weight="bold">4ë‹¨ê³„ ê²€ì¦ (ë‚´ë¶€)</text>
  <text x="350" y="838" text-anchor="middle" class="edge-label" font-size="10">í˜•ì‹(10%) + ì¡°í•­(20%)</text>
  <text x="350" y="852" text-anchor="middle" class="edge-label" font-size="10">ì»¨í…ìŠ¤íŠ¸(30%) + í• ë£¨ì‹œë„¤ì´ì…˜(40%)</text>
  <text x="350" y="870" text-anchor="middle" class="edge-label" font-size="10">â†’ ì‹ ë¢°ë„ &gt;= 0.7 í†µê³¼</text>

  <!-- Arrow: processing_agent â†’ end -->
  <path d="M 700 460 L 700 1100" class="arrow-solid"/>

  <!-- Arrow: management_agent â†’ end -->
  <path d="M 1050 460 L 1050 1100 L 800 1100" class="arrow-solid"/>

  <!-- Arrow: answer_agent â†’ end -->
  <path d="M 350 890 L 350 1100 L 600 1100" class="arrow-solid"/>

  <!-- END -->
  <ellipse cx="700" cy="1100" rx="80" ry="40" class="node-end"/>
  <text x="700" y="1108" text-anchor="middle" class="node-text">__end__</text>

  <!-- ========== ë²”ë¡€ (í•˜ë‹¨) ========== -->
  <rect x="50" y="1200" width="1300" height="550" rx="15" fill="#fff" stroke="#ccc" stroke-width="2"/>
  <text x="700" y="1240" text-anchor="middle" class="title">Agent ìƒì„¸ ì„¤ëª…</text>

  <!-- Router Agent ì„¤ëª… -->
  <rect x="80" y="1270" width="380" height="110" rx="10" fill="#f5f5f5" stroke="#8e24aa" stroke-width="2"/>
  <text x="270" y="1295" text-anchor="middle" class="node-text">ğŸ§­ Router Agent</text>
  <text x="100" y="1320" class="edge-label">â€¢ ì‚¬ìš©ì ì˜ë„ ë¶„ì„ (GPT-4o)</text>
  <text x="100" y="1340" class="edge-label">â€¢ task_type ê²°ì •: search/upload/manage</text>
  <text x="100" y="1360" class="edge-label">â€¢ Command ê°ì²´ë¡œ ë‹¤ìŒ Agent ë¼ìš°íŒ…</text>

  <!-- Search Agent ì„¤ëª… -->
  <rect x="510" y="1270" width="380" height="110" rx="10" fill="#f5f5f5" stroke="#8e24aa" stroke-width="2"/>
  <text x="700" y="1295" text-anchor="middle" class="node-text">ğŸ” Search Agent</text>
  <text x="530" y="1320" class="edge-label">â€¢ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (ë²¡í„° + í‚¤ì›Œë“œ)</text>
  <text x="530" y="1340" class="edge-label">â€¢ RRF ìœµí•© (K=60), ìœ ì‚¬ë„ ì„ê³„ê°’ 0.7</text>
  <text x="530" y="1360" class="edge-label">â€¢ ìµœëŒ€ 20K í† í° ì»¨í…ìŠ¤íŠ¸</text>

  <!-- Processing Agent ì„¤ëª… -->
  <rect x="940" y="1270" width="380" height="110" rx="10" fill="#f5f5f5" stroke="#8e24aa" stroke-width="2"/>
  <text x="1130" y="1295" text-anchor="middle" class="node-text">âš™ï¸ Processing Agent</text>
  <text x="960" y="1320" class="edge-label">â€¢ í•˜ì´ë¸Œë¦¬ë“œ PDF ì „ì²˜ë¦¬</text>
  <text x="960" y="1340" class="edge-label">â€¢ PyMuPDF4LLM + GPT-4o Vision</text>
  <text x="960" y="1360" class="edge-label">â€¢ Quality Validator, Chunking, Embedding</text>

  <!-- Context Judgement Agent ì„¤ëª… -->
  <rect x="80" y="1400" width="380" height="110" rx="10" fill="#d4edda" stroke="#28a745" stroke-width="2"/>
  <text x="270" y="1425" text-anchor="middle" class="node-text">âœ… Context Judgement Agent (NEW)</text>
  <text x="100" y="1450" class="edge-label">â€¢ ê²€ìƒ‰ ì»¨í…ìŠ¤íŠ¸ ì¶©ë¶„ì„± íŒë‹¨</text>
  <text x="100" y="1470" class="edge-label">â€¢ ê¸°ì¤€: ê²°ê³¼ ê°œìˆ˜, ìœ ì‚¬ë„, í† í° ìˆ˜</text>
  <text x="100" y="1490" class="edge-label">â€¢ ë¶ˆì¶©ë¶„ ì‹œ Chunk Expansionìœ¼ë¡œ ë¼ìš°íŒ…</text>

  <!-- Chunk Expansion Agent ì„¤ëª… -->
  <rect x="510" y="1400" width="380" height="110" rx="10" fill="#d4edda" stroke="#28a745" stroke-width="2"/>
  <text x="700" y="1425" text-anchor="middle" class="node-text">ğŸ“ˆ Chunk Expansion Agent (NEW)</text>
  <text x="530" y="1450" class="edge-label">â€¢ ì¸ì ‘ ì²­í¬ ë™ì  í™•ì¥</text>
  <text x="530" y="1470" class="edge-label">â€¢ ìµœëŒ€ 3íšŒ ë°˜ë³µ / 20K í† í° ì œí•œ</text>
  <text x="530" y="1490" class="edge-label">â€¢ Context Judgementë¡œ ì¬íŒë‹¨</text>

  <!-- Answer Agent ì„¤ëª… -->
  <rect x="940" y="1400" width="380" height="110" rx="10" fill="#f5f5f5" stroke="#8e24aa" stroke-width="2"/>
  <text x="1130" y="1425" text-anchor="middle" class="node-text">ğŸ’¬ Answer Agent</text>
  <text x="960" y="1450" class="edge-label">â€¢ GPT-4o ë‹µë³€ ìƒì„± (temperature=0.1)</text>
  <text x="960" y="1470" class="edge-label">â€¢ ë‚´ë¶€ 4ë‹¨ê³„ ê²€ì¦: í˜•ì‹/ì¡°í•­/ì»¨í…ìŠ¤íŠ¸/í• ë£¨ì‹œë„¤ì´ì…˜</text>
  <text x="960" y="1490" class="edge-label">â€¢ ì‹ ë¢°ë„ &gt;= 0.7 í†µê³¼, ë¯¸ë‹¬ ì‹œ ì¬ìƒì„±</text>

  <!-- Management Agent ì„¤ëª… -->
  <rect x="80" y="1530" width="380" height="110" rx="10" fill="#f5f5f5" stroke="#8e24aa" stroke-width="2"/>
  <text x="270" y="1555" text-anchor="middle" class="node-text">ğŸ“ Management Agent</text>
  <text x="100" y="1580" class="edge-label">â€¢ ë¬¸ì„œ CRUD ì‘ì—…</text>
  <text x="100" y="1600" class="edge-label">â€¢ ë¬¸ì„œ ëª©ë¡ ì¡°íšŒ, ì‚­ì œ</text>
  <text x="100" y="1620" class="edge-label">â€¢ ë©”íƒ€ë°ì´í„° ê´€ë¦¬</text>

  <!-- í™”ì‚´í‘œ ë²”ë¡€ -->
  <rect x="510" y="1530" width="380" height="110" rx="10" fill="#f5f5f5" stroke="#666" stroke-width="2"/>
  <text x="700" y="1555" text-anchor="middle" class="node-text">â¡ï¸ í™”ì‚´í‘œ íƒ€ì…</text>
  <line x1="540" y1="1580" x2="620" y2="1580" stroke="#424242" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="640" y="1585" class="edge-label">ì‹¤ì„ : ì¼ë°˜ í”Œë¡œìš°</text>
  <line x1="540" y1="1605" x2="620" y2="1605" stroke="#424242" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="640" y="1610" class="edge-label">ì ì„ : ë£¨í”„ë°±/ì¬ì‹œë„</text>
  <line x1="540" y1="1630" x2="620" y2="1630" stroke="#f57c00" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
  <text x="640" y="1635" class="edge-label">ì£¼í™©: ì¡°ê±´ë¶€ ë¼ìš°íŒ…</text>

  <!-- ì£¼ìš” íŠ¹ì§• -->
  <rect x="940" y="1530" width="380" height="110" rx="10" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="1130" y="1555" text-anchor="middle" class="node-text">â­ ì£¼ìš” íŠ¹ì§•</text>
  <text x="960" y="1580" class="edge-label">â€¢ 7ê°œ ì „ë¬¸í™”ëœ Agent</text>
  <text x="960" y="1600" class="edge-label">â€¢ ì¡°ê±´ë¶€ ë¼ìš°íŒ… (Command íŒ¨í„´)</text>
  <text x="960" y="1620" class="edge-label">â€¢ ë™ì  ì»¨í…ìŠ¤íŠ¸ í™•ì¥ &amp; ì¬íŒë‹¨</text>

  <!-- í•˜ë‹¨ ë²„ì „ ì •ë³´ -->
  <text x="700" y="1720" text-anchor="middle" class="edge-label">LangGraph 0.3.27+ | Python 3.11 | ISPL v2.0</text>

</svg>

