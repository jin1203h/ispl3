<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1000">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #1a1a1a; }
      .subtitle { font: bold 16px sans-serif; fill: #2c3e50; }
      .text { font: 14px sans-serif; fill: #34495e; }
      .small-text { font: 12px sans-serif; fill: #555; }
      .box-router { fill: #fff3cd; stroke: #f39c12; stroke-width: 3; }
      .box-agent { fill: #d1ecf1; stroke: #0c5460; stroke-width: 2; }
      .box-sub { fill: #d4edda; stroke: #28a745; stroke-width: 2; }
      .box-user { fill: #e2e3e5; stroke: #6c757d; stroke-width: 2; }
      .arrow { stroke: #495057; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-intent { stroke: #e74c3c; stroke-width: 2; fill: none; marker-end: url(#arrowhead); stroke-dasharray: 5,5; }
      .label-intent { font: bold 13px sans-serif; fill: #e74c3c; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#495057" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" class="title">LangGraph Multi-Agent 상세 구조</text>

  <!-- User Input -->
  <rect x="575" y="80" width="250" height="60" rx="10" class="box-user"/>
  <text x="700" y="105" text-anchor="middle" class="subtitle">사용자 요청</text>
  <text x="700" y="125" text-anchor="middle" class="small-text">"골절 시 보장 여부?"</text>

  <!-- Arrow to Router -->
  <path d="M 700 140 L 700 190" class="arrow"/>

  <!-- Router Agent -->
  <rect x="525" y="190" width="350" height="100" rx="10" class="box-router"/>
  <text x="700" y="220" text-anchor="middle" class="subtitle">Router Agent (라우터)</text>
  <text x="700" y="245" text-anchor="middle" class="text">의도 분류 및 라우팅</text>
  <text x="700" y="265" text-anchor="middle" class="small-text">입력: 사용자 질의</text>
  <text x="700" y="280" text-anchor="middle" class="small-text">출력: 의도 분류 (search/upload/manage)</text>

  <!-- Intent Labels -->
  <text x="300" y="320" text-anchor="middle" class="label-intent">[search/질문]</text>
  <text x="700" y="320" text-anchor="middle" class="label-intent">[upload/업로드]</text>
  <text x="1100" y="320" text-anchor="middle" class="label-intent">[manage/관리]</text>

  <!-- Arrows to Agents -->
  <path d="M 600 290 L 300 350" class="arrow-intent"/>
  <path d="M 700 290 L 700 350" class="arrow-intent"/>
  <path d="M 800 290 L 1100 350" class="arrow-intent"/>

  <!-- Search Agent -->
  <rect x="80" y="350" width="440" height="240" rx="10" class="box-agent"/>
  <text x="300" y="380" text-anchor="middle" class="subtitle">Search Agent (검색)</text>
  
  <rect x="110" y="400" width="180" height="170" rx="5" class="box-sub"/>
  <text x="200" y="425" text-anchor="middle" class="text">검색 처리</text>
  <text x="200" y="445" text-anchor="middle" class="small-text">• 질의 전처리</text>
  <text x="200" y="460" text-anchor="middle" class="small-text">  - 맞춤법 검사</text>
  <text x="200" y="475" text-anchor="middle" class="small-text">  - 전문용어 표준화</text>
  <text x="200" y="490" text-anchor="middle" class="small-text">  - 동의어 확장</text>
  <text x="200" y="510" text-anchor="middle" class="small-text">• 쿼리 임베딩 생성</text>
  <text x="200" y="525" text-anchor="middle" class="small-text">• 벡터 검색 수행</text>
  <text x="200" y="540" text-anchor="middle" class="small-text">• 하이브리드 검색</text>
  <text x="200" y="555" text-anchor="middle" class="small-text">• 컨텍스트 최적화</text>

  <rect x="310" y="400" width="190" height="170" rx="5" class="box-sub"/>
  <text x="405" y="425" text-anchor="middle" class="text">검색 결과</text>
  <text x="405" y="445" text-anchor="middle" class="small-text">• 관련 청크 목록</text>
  <text x="405" y="460" text-anchor="middle" class="small-text">• 유사도 점수</text>
  <text x="405" y="475" text-anchor="middle" class="small-text">• 문서 메타데이터</text>
  <text x="405" y="495" text-anchor="middle" class="small-text">→ Answer Agent로</text>

  <!-- Arrow: Search to Answer -->
  <path d="M 300 590 L 300 650" class="arrow"/>

  <!-- Answer Agent -->
  <rect x="80" y="650" width="440" height="240" rx="10" class="box-agent"/>
  <text x="300" y="680" text-anchor="middle" class="subtitle">Answer Agent (답변)</text>
  
  <rect x="110" y="700" width="180" height="170" rx="5" class="box-sub"/>
  <text x="200" y="725" text-anchor="middle" class="text">답변 생성</text>
  <text x="200" y="745" text-anchor="middle" class="small-text">• 시스템 프롬프트</text>
  <text x="200" y="760" text-anchor="middle" class="small-text">  - 정확성 보장</text>
  <text x="200" y="775" text-anchor="middle" class="small-text">  - 근거 제시</text>
  <text x="200" y="790" text-anchor="middle" class="small-text">  - 한계 인정</text>
  <text x="200" y="810" text-anchor="middle" class="small-text">• 컨텍스트 조립</text>
  <text x="200" y="825" text-anchor="middle" class="small-text">• GPT-4 호출</text>
  <text x="200" y="840" text-anchor="middle" class="small-text">  (temperature: 0.1)</text>

  <rect x="310" y="700" width="190" height="170" rx="5" class="box-sub"/>
  <text x="405" y="725" text-anchor="middle" class="text">검증 &amp; 포맷팅</text>
  <text x="405" y="745" text-anchor="middle" class="small-text">• 할루시네이션 검증</text>
  <text x="405" y="760" text-anchor="middle" class="small-text">• 조항 번호 확인</text>
  <text x="405" y="775" text-anchor="middle" class="small-text">• 신뢰도 계산</text>
  <text x="405" y="795" text-anchor="middle" class="small-text">• 응답 구조화:</text>
  <text x="405" y="810" text-anchor="middle" class="small-text">  ① 직접 답변</text>
  <text x="405" y="825" text-anchor="middle" class="small-text">  ② 관련 약관</text>
  <text x="405" y="840" text-anchor="middle" class="small-text">  ③ 주의사항</text>

  <!-- Processing Agent -->
  <rect x="580" y="350" width="240" height="240" rx="10" class="box-agent"/>
  <text x="700" y="380" text-anchor="middle" class="subtitle">Processing Agent</text>
  <text x="700" y="400" text-anchor="middle" class="subtitle">(전처리)</text>
  
  <rect x="600" y="420" width="200" height="160" rx="5" class="box-sub"/>
  <text x="700" y="445" text-anchor="middle" class="text">PDF 처리</text>
  <text x="700" y="465" text-anchor="middle" class="small-text">Path 1: 직접 추출</text>
  <text x="700" y="480" text-anchor="middle" class="small-text">• PyMuPDF4LLM</text>
  <text x="700" y="500" text-anchor="middle" class="small-text">Path 2: 멀티모달</text>
  <text x="700" y="515" text-anchor="middle" class="small-text">• GPT-4 Vision</text>
  <text x="700" y="535" text-anchor="middle" class="small-text">• 결과 병합 &amp; 검증</text>
  <text x="700" y="550" text-anchor="middle" class="small-text">• 청킹 &amp; 임베딩</text>
  <text x="700" y="565" text-anchor="middle" class="small-text">• 벡터 DB 저장</text>

  <!-- Management Agent -->
  <rect x="880" y="350" width="440" height="240" rx="10" class="box-agent"/>
  <text x="1100" y="380" text-anchor="middle" class="subtitle">Management Agent (관리)</text>
  
  <rect x="910" y="400" width="180" height="170" rx="5" class="box-sub"/>
  <text x="1000" y="425" text-anchor="middle" class="text">조회 기능</text>
  <text x="1000" y="445" text-anchor="middle" class="small-text">• 약관 목록 조회</text>
  <text x="1000" y="460" text-anchor="middle" class="small-text">• 필터링</text>
  <text x="1000" y="475" text-anchor="middle" class="small-text">  - 문서 타입</text>
  <text x="1000" y="490" text-anchor="middle" class="small-text">  - 보험사</text>
  <text x="1000" y="505" text-anchor="middle" class="small-text">  - 날짜 범위</text>
  <text x="1000" y="525" text-anchor="middle" class="small-text">• 정렬 &amp; 페이징</text>
  <text x="1000" y="540" text-anchor="middle" class="small-text">• PDF/MD 뷰어</text>

  <rect x="1110" y="400" width="190" height="170" rx="5" class="box-sub"/>
  <text x="1205" y="425" text-anchor="middle" class="text">관리 기능</text>
  <text x="1205" y="445" text-anchor="middle" class="small-text">• 약관 삭제</text>
  <text x="1205" y="460" text-anchor="middle" class="small-text">  - DB 레코드</text>
  <text x="1205" y="475" text-anchor="middle" class="small-text">  - 로컬 파일</text>
  <text x="1205" y="490" text-anchor="middle" class="small-text">  - 벡터 데이터</text>
  <text x="1205" y="510" text-anchor="middle" class="small-text">• 파일 다운로드</text>
  <text x="1205" y="525" text-anchor="middle" class="small-text">  - 원본 PDF</text>
  <text x="1205" y="540" text-anchor="middle" class="small-text">  - Markdown</text>

  <!-- Return Arrows -->
  <path d="M 300 890 L 600 940" class="arrow"/>
  <path d="M 700 590 L 700 940" class="arrow"/>
  <path d="M 1100 590 L 800 940" class="arrow"/>

  <!-- User Response -->
  <rect x="575" y="940" width="250" height="50" rx="10" class="box-user"/>
  <text x="700" y="970" text-anchor="middle" class="subtitle">사용자 응답</text>

</svg>
