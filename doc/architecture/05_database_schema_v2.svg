<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1000">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #1a1a1a; }
      .table-title { font: bold 16px sans-serif; fill: #ffffff; }
      .field-pk { font: bold 13px sans-serif; fill: #e74c3c; }
      .field-fk { font: bold 13px sans-serif; fill: #3498db; }
      .field { font: 13px sans-serif; fill: #2c3e50; }
      .field-type { font: 12px sans-serif; fill: #7f8c8d; }
      .field-new { font: bold 13px sans-serif; fill: #28a745; }
      .table-header { fill: #34495e; }
      .table-body { fill: #ffffff; stroke: #34495e; stroke-width: 2; }
      .table-new { fill: #d4edda; stroke: #28a745; stroke-width: 3; }
      .relation { stroke: #7f8c8d; stroke-width: 2; fill: none; marker-end: url(#arrow-relation); }
      .note { font: 12px sans-serif; fill: #16a085; font-style: italic; }
      .label-new { font: bold 11px sans-serif; fill: #28a745; }
    </style>
    <marker id="arrow-relation" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <polygon points="0 0, 8 4, 0 8" fill="#7f8c8d" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" class="title">데이터베이스 스키마 구조 v2 (Chat Sessions 추가)</text>

  <!-- Users Table -->
  <g>
    <rect x="50" y="100" width="350" height="40" class="table-header"/>
    <text x="225" y="125" text-anchor="middle" class="table-title">users (사용자 정보)</text>
    
    <rect x="50" y="140" width="350" height="280" class="table-body"/>
    
    <text x="70" y="165" class="field-pk">id</text>
    <text x="320" y="165" text-anchor="end" class="field-type">SERIAL PRIMARY KEY</text>
    
    <text x="70" y="190" class="field">username</text>
    <text x="320" y="190" text-anchor="end" class="field-type">VARCHAR(50) UNIQUE</text>
    
    <text x="70" y="215" class="field">email</text>
    <text x="320" y="215" text-anchor="end" class="field-type">VARCHAR(100) UNIQUE</text>
    
    <text x="70" y="240" class="field">full_name</text>
    <text x="320" y="240" text-anchor="end" class="field-type">VARCHAR(100)</text>
    
    <text x="70" y="265" class="field">role</text>
    <text x="320" y="265" text-anchor="end" class="field-type">VARCHAR(20)</text>
    
    <text x="70" y="290" class="field">insurance_preferences</text>
    <text x="320" y="290" text-anchor="end" class="field-type">JSONB</text>
    
    <text x="70" y="315" class="field">created_at</text>
    <text x="320" y="315" text-anchor="end" class="field-type">TIMESTAMP</text>
    
    <text x="70" y="340" class="field">last_login</text>
    <text x="320" y="340" text-anchor="end" class="field-type">TIMESTAMP</text>
    
    <text x="70" y="365" class="field">is_active</text>
    <text x="320" y="365" text-anchor="end" class="field-type">BOOLEAN</text>
    
    <text x="70" y="395" class="note">인덱스: email, role</text>
  </g>

  <!-- Documents Table -->
  <g>
    <rect x="525" y="100" width="400" height="40" class="table-header"/>
    <text x="725" y="125" text-anchor="middle" class="table-title">documents (문서 메타데이터)</text>
    
    <rect x="525" y="140" width="400" height="380" class="table-body"/>
    
    <text x="545" y="165" class="field-pk">id</text>
    <text x="850" y="165" text-anchor="end" class="field-type">SERIAL PRIMARY KEY</text>
    
    <text x="545" y="190" class="field">filename</text>
    <text x="850" y="190" text-anchor="end" class="field-type">VARCHAR(255)</text>
    
    <text x="545" y="215" class="field">original_filename</text>
    <text x="850" y="215" text-anchor="end" class="field-type">VARCHAR(255)</text>
    
    <text x="545" y="240" class="field">file_path</text>
    <text x="850" y="240" text-anchor="end" class="field-type">TEXT</text>
    
    <text x="545" y="265" class="field">document_type</text>
    <text x="850" y="265" text-anchor="end" class="field-type">VARCHAR(50)</text>
    
    <text x="545" y="290" class="field">insurance_type</text>
    <text x="850" y="290" text-anchor="end" class="field-type">VARCHAR(50)</text>
    
    <text x="545" y="315" class="field">company_name</text>
    <text x="850" y="315" text-anchor="end" class="field-type">VARCHAR(100)</text>
    
    <text x="545" y="340" class="field">status</text>
    <text x="850" y="340" text-anchor="end" class="field-type">VARCHAR(20)</text>
    
    <text x="545" y="365" class="field">total_pages</text>
    <text x="850" y="365" text-anchor="end" class="field-type">INTEGER</text>
    
    <text x="545" y="390" class="field">processing_status</text>
    <text x="850" y="390" text-anchor="end" class="field-type">VARCHAR(20)</text>
    
    <text x="545" y="415" class="field-fk">created_by</text>
    <text x="850" y="415" text-anchor="end" class="field-type">INTEGER FK → users</text>
    
    <text x="545" y="440" class="field">upload_timestamp</text>
    <text x="850" y="440" text-anchor="end" class="field-type">TIMESTAMP</text>
    
    <text x="545" y="465" class="field">processed_timestamp</text>
    <text x="850" y="465" text-anchor="end" class="field-type">TIMESTAMP</text>
    
    <text x="545" y="495" class="note">인덱스: document_type, insurance_type, status</text>
  </g>

  <!-- Relation: users → documents -->
  <path d="M 400 280 L 525 280" class="relation"/>
  <text x="450" y="270" class="field-type">1:N</text>

  <!-- Document Chunks Table -->
  <g>
    <rect x="1000" y="100" width="370" height="40" class="table-header"/>
    <text x="1185" y="125" text-anchor="middle" class="table-title">document_chunks (청크)</text>
    
    <rect x="1000" y="140" width="370" height="430" class="table-body"/>
    
    <text x="1020" y="165" class="field-pk">id</text>
    <text x="1310" y="165" text-anchor="end" class="field-type">SERIAL PRIMARY KEY</text>
    
    <text x="1020" y="190" class="field-fk">document_id</text>
    <text x="1310" y="190" text-anchor="end" class="field-type">INTEGER FK → documents</text>
    
    <text x="1020" y="215" class="field">chunk_index</text>
    <text x="1310" y="215" text-anchor="end" class="field-type">INTEGER</text>
    
    <text x="1020" y="240" class="field">chunk_type</text>
    <text x="1310" y="240" text-anchor="end" class="field-type">VARCHAR(20)</text>
    
    <text x="1020" y="265" class="field">page_number</text>
    <text x="1310" y="265" text-anchor="end" class="field-type">INTEGER (물리적)</text>
    
    <text x="1020" y="290" class="field-new">pdf_page_number ⭐</text>
    <text x="1310" y="290" text-anchor="end" class="field-type">INTEGER (인쇄 페이지) NEW</text>
    
    <text x="1020" y="315" class="field">section_title</text>
    <text x="1310" y="315" text-anchor="end" class="field-type">VARCHAR(200)</text>
    
    <text x="1020" y="340" class="field">clause_number</text>
    <text x="1310" y="340" text-anchor="end" class="field-type">VARCHAR(50)</text>
    
    <text x="1020" y="365" class="field">content</text>
    <text x="1310" y="365" text-anchor="end" class="field-type">TEXT</text>
    
    <text x="1020" y="390" class="field">content_hash</text>
    <text x="1310" y="390" text-anchor="end" class="field-type">VARCHAR(64) SHA-256</text>
    
    <text x="1020" y="415" class="field">embedding</text>
    <text x="1310" y="415" text-anchor="end" class="field-type">VECTOR(1536) ⭐</text>
    
    <text x="1020" y="440" class="field">metadata</text>
    <text x="1310" y="440" text-anchor="end" class="field-type">JSONB</text>
    
    <text x="1020" y="465" class="field">token_count</text>
    <text x="1310" y="465" text-anchor="end" class="field-type">INTEGER</text>
    
    <text x="1020" y="490" class="field">confidence_score</text>
    <text x="1310" y="490" text-anchor="end" class="field-type">FLOAT</text>
    
    <text x="1020" y="515" class="field">created_at</text>
    <text x="1310" y="515" text-anchor="end" class="field-type">TIMESTAMP</text>
    
    <text x="1020" y="545" class="note">HNSW 인덱스: embedding (Cosine Similarity)</text>
    <text x="1020" y="560" class="note">인덱스: pdf_page_number ⭐ NEW</text>
  </g>

  <!-- Relation: documents → document_chunks -->
  <path d="M 925 280 L 1000 280" class="relation"/>
  <text x="950" y="270" class="field-type">1:N</text>

  <!-- Chat Sessions Table (NEW) -->
  <g>
    <rect x="50" y="560" width="350" height="40" class="table-new"/>
    <text x="225" y="585" text-anchor="middle" class="table-title">chat_sessions ⭐ NEW</text>
    
    <rect x="50" y="600" width="350" height="200" class="table-new"/>
    
    <text x="70" y="625" class="field-pk">id</text>
    <text x="320" y="625" text-anchor="end" class="field-type">SERIAL PRIMARY KEY</text>
    
    <text x="70" y="650" class="field-fk">user_id</text>
    <text x="320" y="650" text-anchor="end" class="field-type">INTEGER FK → users</text>
    
    <text x="70" y="675" class="field-new">title ⭐</text>
    <text x="320" y="675" text-anchor="end" class="field-type">VARCHAR(255)</text>
    
    <text x="70" y="700" class="field-new">created_at ⭐</text>
    <text x="320" y="700" text-anchor="end" class="field-type">TIMESTAMP</text>
    
    <text x="70" y="725" class="field-new">updated_at ⭐</text>
    <text x="320" y="725" text-anchor="end" class="field-type">TIMESTAMP</text>
    
    <text x="70" y="760" class="label-new">채팅 세션 관리</text>
    <text x="70" y="780" class="note">인덱스: user_id</text>
  </g>

  <!-- Relation: users → chat_sessions -->
  <path d="M 225 420 L 225 560" class="relation"/>
  <text x="240" y="490" class="field-type">1:N</text>

  <!-- Chat Messages Table (NEW) -->
  <g>
    <rect x="500" y="560" width="400" height="40" class="table-new"/>
    <text x="700" y="585" text-anchor="middle" class="table-title">chat_messages ⭐ NEW</text>
    
    <rect x="500" y="600" width="400" height="230" class="table-new"/>
    
    <text x="520" y="625" class="field-pk">id</text>
    <text x="820" y="625" text-anchor="end" class="field-type">SERIAL PRIMARY KEY</text>
    
    <text x="520" y="650" class="field-fk">session_id</text>
    <text x="820" y="650" text-anchor="end" class="field-type">INTEGER FK → chat_sessions</text>
    
    <text x="520" y="675" class="field-new">role ⭐</text>
    <text x="820" y="675" text-anchor="end" class="field-type">VARCHAR(20) user/assistant</text>
    
    <text x="520" y="700" class="field-new">content ⭐</text>
    <text x="820" y="700" text-anchor="end" class="field-type">TEXT</text>
    
    <text x="520" y="725" class="field-new">metadata ⭐</text>
    <text x="820" y="725" text-anchor="end" class="field-type">JSONB</text>
    
    <text x="520" y="750" class="field-new">created_at ⭐</text>
    <text x="820" y="750" text-anchor="end" class="field-type">TIMESTAMP</text>
    
    <text x="520" y="790" class="label-new">대화 메시지 저장</text>
    <text x="520" y="810" class="note">인덱스: session_id, CASCADE DELETE</text>
  </g>

  <!-- Relation: chat_sessions → chat_messages -->
  <path d="M 400 680 L 500 680" class="relation"/>
  <text x="440" y="670" class="field-type">1:N</text>

  <!-- Search Logs Table -->
  <g>
    <rect x="970" y="640" width="400" height="40" class="table-header"/>
    <text x="1170" y="665" text-anchor="middle" class="table-title">search_logs (검색 로그)</text>
    
    <rect x="970" y="680" width="400" height="230" class="table-body"/>
    
    <text x="990" y="705" class="field-pk">id</text>
    <text x="1295" y="705" text-anchor="end" class="field-type">SERIAL PRIMARY KEY</text>
    
    <text x="990" y="730" class="field-fk">user_id</text>
    <text x="1295" y="730" text-anchor="end" class="field-type">INTEGER FK → users</text>
    
    <text x="990" y="755" class="field">query</text>
    <text x="1295" y="755" text-anchor="end" class="field-type">TEXT</text>
    
    <text x="990" y="780" class="field">search_type</text>
    <text x="1295" y="780" text-anchor="end" class="field-type">VARCHAR(20) vector/keyword/hybrid</text>
    
    <text x="990" y="805" class="field">results_count</text>
    <text x="1295" y="805" text-anchor="end" class="field-type">INTEGER</text>
    
    <text x="990" y="830" class="field">top_similarity_score</text>
    <text x="1295" y="830" text-anchor="end" class="field-type">FLOAT</text>
    
    <text x="990" y="855" class="field">response_time_ms</text>
    <text x="1295" y="855" text-anchor="end" class="field-type">INTEGER</text>
    
    <text x="990" y="880" class="field">created_at</text>
    <text x="1295" y="880" text-anchor="end" class="field-type">TIMESTAMP</text>
  </g>

  <!-- Legend -->
  <rect x="50" y="860" width="850" height="110" rx="5" stroke="#95a5a6" stroke-width="2" fill="#ecf0f1"/>
  <text x="475" y="885" text-anchor="middle" class="subtitle" style="fill: #2c3e50;">범례 (Legend) v2</text>
  <text x="70" y="910" class="field-pk">PK</text>
  <text x="130" y="910" class="field">= Primary Key (기본 키)</text>
  <text x="70" y="935" class="field-fk">FK</text>
  <text x="130" y="935" class="field">= Foreign Key (외래 키)</text>
  <text x="70" y="960" class="field">VECTOR(1536) ⭐</text>
  <text x="210" y="960" class="field">= pgvector 확장 타입</text>
  <text x="470" y="910" class="field-new">⭐ NEW</text>
  <text x="560" y="910" class="field">= v2 신규 추가 항목</text>
  <text x="470" y="935" class="label-new">pdf_page_number</text>
  <text x="620" y="935" class="field">= PDF 인쇄 페이지 번호 (신규 필드)</text>
  <text x="470" y="960" class="label-new">chat_sessions/messages</text>
  <text x="640" y="960" class="field">= 채팅 이력 관리 (신규 테이블)</text>

</svg>




