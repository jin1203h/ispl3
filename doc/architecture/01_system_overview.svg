<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #1a1a1a; }
      .subtitle { font: bold 16px sans-serif; fill: #2c3e50; }
      .text { font: 14px sans-serif; fill: #34495e; }
      .small-text { font: 12px sans-serif; fill: #555; }
      .box { fill: #fff; stroke: #3498db; stroke-width: 2; }
      .box-frontend { fill: #e8f4f8; stroke: #3498db; stroke-width: 2; }
      .box-backend { fill: #fff5e6; stroke: #f39c12; stroke-width: 2; }
      .box-agent { fill: #e8f8f5; stroke: #16a085; stroke-width: 2; }
      .box-service { fill: #f4ecf7; stroke: #8e44ad; stroke-width: 2; }
      .arrow { stroke: #2c3e50; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-bi { stroke: #2c3e50; stroke-width: 2; fill: none; marker-end: url(#arrowhead); marker-start: url(#arrowhead-start); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2c3e50" />
    </marker>
    <marker id="arrowhead-start" markerWidth="10" markerHeight="10" refX="1" refY="3" orient="auto">
      <polygon points="10 0, 0 3, 10 6" fill="#2c3e50" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" class="title">ISPL 시스템 아키텍처 전체 구조</text>

  <!-- Frontend Layer -->
  <rect x="50" y="80" width="1100" height="150" rx="10" class="box-frontend"/>
  <text x="600" y="110" text-anchor="middle" class="subtitle">사용자 인터페이스 (React/Next.js Frontend)</text>
  
  <rect x="100" y="130" width="280" height="80" rx="5" class="box"/>
  <text x="240" y="160" text-anchor="middle" class="text">채팅 화면 (메인)</text>
  <text x="240" y="180" text-anchor="middle" class="small-text">• 대화 입력/출력</text>
  <text x="240" y="195" text-anchor="middle" class="small-text">• 실시간 스트리밍</text>

  <rect x="420" y="130" width="280" height="80" rx="5" class="box"/>
  <text x="560" y="160" text-anchor="middle" class="text">약관 관리 화면</text>
  <text x="560" y="180" text-anchor="middle" class="small-text">• 업로드/삭제</text>
  <text x="560" y="195" text-anchor="middle" class="small-text">• 목록 조회</text>

  <rect x="740" y="130" width="280" height="80" rx="5" class="box"/>
  <text x="880" y="160" text-anchor="middle" class="text">참조 문서 패널</text>
  <text x="880" y="180" text-anchor="middle" class="small-text">• 출처 표시</text>
  <text x="880" y="195" text-anchor="middle" class="small-text">• 유사도 점수</text>

  <!-- Arrow: Frontend to Backend -->
  <path d="M 600 230 L 600 270" class="arrow"/>
  <text x="650" y="255" class="small-text">HTTP/WebSocket</text>

  <!-- Backend Layer -->
  <rect x="50" y="270" width="1100" height="380" rx="10" class="box-backend"/>
  <text x="600" y="300" text-anchor="middle" class="subtitle">FastAPI Backend + LangGraph Multi-Agent System</text>

  <!-- Router Agent -->
  <rect x="420" y="320" width="360" height="60" rx="5" class="box-agent"/>
  <text x="600" y="345" text-anchor="middle" class="text">Router Agent (라우터)</text>
  <text x="600" y="365" text-anchor="middle" class="small-text">사용자 요청 분석 및 의도 분류 (search/upload/manage)</text>

  <!-- Arrows from Router -->
  <path d="M 480 380 L 240 420" class="arrow"/>
  <text x="330" y="395" class="small-text">search</text>
  
  <path d="M 600 380 L 600 420" class="arrow"/>
  <text x="620" y="405" class="small-text">upload</text>
  
  <path d="M 720 380 L 960 420" class="arrow"/>
  <text x="870" y="395" class="small-text">manage</text>

  <!-- Processing Agent -->
  <rect x="460" y="420" width="280" height="100" rx="5" class="box-agent"/>
  <text x="600" y="445" text-anchor="middle" class="text">Processing Agent</text>
  <text x="600" y="465" text-anchor="middle" class="small-text">• Path 1: PyMuPDF4LLM</text>
  <text x="600" y="480" text-anchor="middle" class="small-text">• Path 2: GPT-4 Vision</text>
  <text x="600" y="495" text-anchor="middle" class="small-text">• 병합 &amp; 품질 검증</text>
  <text x="600" y="510" text-anchor="middle" class="small-text">• 청킹 &amp; 임베딩</text>

  <!-- Search Agent -->
  <rect x="100" y="420" width="280" height="70" rx="5" class="box-agent"/>
  <text x="240" y="445" text-anchor="middle" class="text">Search Agent</text>
  <text x="240" y="465" text-anchor="middle" class="small-text">• 벡터 검색</text>
  <text x="240" y="480" text-anchor="middle" class="small-text">• 하이브리드 검색</text>

  <!-- Answer Agent -->
  <rect x="100" y="510" width="280" height="70" rx="5" class="box-agent"/>
  <text x="240" y="535" text-anchor="middle" class="text">Answer Agent</text>
  <text x="240" y="555" text-anchor="middle" class="small-text">• LLM 답변 생성</text>
  <text x="240" y="570" text-anchor="middle" class="small-text">• 할루시네이션 검증</text>

  <!-- Management Agent -->
  <rect x="820" y="420" width="280" height="100" rx="5" class="box-agent"/>
  <text x="960" y="445" text-anchor="middle" class="text">Management Agent</text>
  <text x="960" y="465" text-anchor="middle" class="small-text">• 목록 조회</text>
  <text x="960" y="480" text-anchor="middle" class="small-text">• 삭제</text>
  <text x="960" y="495" text-anchor="middle" class="small-text">• 다운로드</text>
  <text x="960" y="510" text-anchor="middle" class="small-text">• PDF/MD 뷰어</text>

  <!-- Arrow: Search to Answer -->
  <path d="M 240 490 L 240 510" class="arrow"/>

  <!-- Arrow: Backend to Services -->
  <path d="M 600 650 L 600 690" class="arrow"/>

  <!-- External Services Layer -->
  <rect x="50" y="690" width="1100" height="170" rx="10" class="box-service"/>
  <text x="600" y="720" text-anchor="middle" class="subtitle">외부 서비스 &amp; 데이터 저장소</text>

  <rect x="120" y="740" width="280" height="100" rx="5" class="box"/>
  <text x="260" y="770" text-anchor="middle" class="text">OpenAI API</text>
  <text x="260" y="790" text-anchor="middle" class="small-text">• GPT-4 (답변 생성)</text>
  <text x="260" y="805" text-anchor="middle" class="small-text">• GPT-4 Vision (전처리)</text>
  <text x="260" y="820" text-anchor="middle" class="small-text">• text-embedding-3-large</text>

  <rect x="460" y="740" width="280" height="100" rx="5" class="box"/>
  <text x="600" y="770" text-anchor="middle" class="text">PostgreSQL + pgvector</text>
  <text x="600" y="790" text-anchor="middle" class="small-text">• 벡터 검색 (HNSW)</text>
  <text x="600" y="805" text-anchor="middle" class="small-text">• 메타데이터 저장</text>
  <text x="600" y="820" text-anchor="middle" class="small-text">• 로그 관리</text>

  <rect x="800" y="740" width="280" height="100" rx="5" class="box"/>
  <text x="940" y="770" text-anchor="middle" class="text">파일 시스템</text>
  <text x="940" y="790" text-anchor="middle" class="small-text">• uploads/documents/</text>
  <text x="940" y="805" text-anchor="middle" class="small-text">• uploads/images/</text>
  <text x="940" y="820" text-anchor="middle" class="small-text">• uploads/temp/</text>

</svg>
